# リニアステージの操作方法について

※装置のマニュアルおよび専用ソフト`EZED3`のダウンロードページはWeb上で見つからなかったので記載していません．持っている方から直接もらってください．詳しいピンアサイン，パルス入力の仕様等はマニュアルに詳しいのでそちらも併せて参照ください．

## 装置構成
+ リニアステージ ... OrientalMotor, 
+ ドライバ（アンプ） ... OrientalMotor, EDR36D-K
+ ドライバとPCの通信ケーブル ... OrientalMotor, CC05IF-USB
+ 電源装置（DC24V）

## 専用ソフト（EZED3）を使用した装置の動作確認

### 環境構築
1. CC05IF-USB 用のドライバをインストール
	Oriental MotorのWebページ（https://www.orientalmotor.co.jp/download/software/mexe02/）からドライバのみをダウンロードする．  
	解凍したフォルダの中の`64bit版の`setup.exe`を実行する．

2. EZED3 のインストール
	データ編集用ソフト EZED3 (`soft_ezed3_v-7_1-20j.zip`) を展開し，setup.exe を実行，指示に従いソフトをインストールする．  

### ハードウェアのセットアップ
1. 電源装置 <-> ドライバ（アンプ） <-> 直動装置 間をすべて接続した状態でAC電源コードを差す．  
		-> ドライバのランプが緑に点灯していればOK．  
2. その後，通信ケーブルをPCに差し，COMポートの番号を確認する．  

### 動作確認
1. EZED3を起動し，`通信` -> `オプション` で接続しているCOMポートを指定する．  
2. `通信` -> `接続製品情報` を選択し，`確認`ボタンを押すとドライバと直動装置の型番を認識してくれます．  
3. `ファイル` -> `新規作成` を選択すると現れるウィンドウで`機種検索`ボタンを押す．  
4. `メカ品名`，`ドライバ品名` が自動で選択されるので正しければ`OK`ボタンを押して新規コードを作成する．  
5. 新規コードで現れる左側のツリーで`テスト` -> `運転`を選択する．  
6. `テスト運転を開始する`にチェックを入れるとテスト運転モードになる（この時点では動作はしない）．  
	-> 同期モードを訊かれたら`アップロード`を選択（他の選択肢でも可？）  
7. 【動作注意】`JOG運転` 欄の右矢印や左矢印を押すとステージが動くことを確認する．  
	-> 可動域の端でさらに動かそうとすると`ステータス`欄の`現在のアラーム`により指摘され，`アラームリセット`するまで動作しなくなります．  

## 外部信号で駆動するサンプルコード
アンプ（EDR36D-K）は外部入力端子にパルス列信号を入力することにより外部機器からの操作ができます．
ここでは外部機器として`Arduino UNO`を使用して，順駆動・逆駆動・原点復帰の3動作を行うための構成例をまとめます．

### `main/`
シリアル通信を介して`ArduinoUNO`からリニアステージを駆動するためのサンプルコード．
* main.ino ... Arduinoのコード．これを`Arduino`に書き込む．ArduinoIDEのシリアルモニタを立ち上げ，文字を送信するとリニアステージが駆動する．

| 動作 | コマンド | 説明 |
| :-: | :-: | :-- |
| 順駆動 	| `f` | PWM出力機能を使用して5番ピンから1秒間パルス列を生成し続ける※． |
| 逆駆動 	| `r` | PWM出力機能を使用して6番ピンから1秒間パルス列を生成し続ける※．   |
| 原点復帰 	| `0` （ゼロ） | デジタル出力機能を使用して8番ピンを0.1秒間オンにする．原点復帰動作は一度オンにすると，ステージがモータ側端にぶつかるまで移動し，折り返して原点で停止する．（`EZED3`を使用すれば，原点をモータ側端にとるかモータと反対側端にとるかを設定可能なようです．） |

※Arduinoの仕様上，5，6番ピンのPWM出力は960Hz（？）なので，距離にして1秒間で10mmほど駆動する．  

Arduinoを用いた配線例  
![Arduinoを用いた配線例]()
![Arduinoを用いた配線図]()

* 注意1）順駆動，逆駆動は5Vのパルス列信号でそのまま駆動できますが，__原点復帰信号はDC24V駆動__ですので工夫が必要です．今回はリレーを使用しましたがFETでもいいと思います．
* 注意2）この構成では電源装置の出力からアンプと並列でDC24Vをとって使用しています．アンプ内部に6.8kΩの内部抵抗があるそうなので，直接流し込んで大丈夫と判断しました．
